{% extends "base.html" %}

{% block title %}My Interviews{% endblock %}

{% block Addnav %}
<!--<li class="nav-item active">
  <a class="nav-links" role="menuitem" href="/interviews">Interviews</a>
</li>-->
{% endblock %}

{% block content %}
<style>
 .modal {
        z-index: 1055 !important;
        position: absolute !important;
        top: 0 !important;
        left: 0 !important;
        width: 100% !important;
        height: 100% !important;
        background-color: rgba(0, 0, 0, 0.5) !important;
       overflow-y: auto !important;
       margin-top: 15px;
      }

      .modal.show {
        align-items: center !important;
        justify-content: center !important;
      padding-top: 50rem !important;
        padding-bottom: 0 !important;
      }
  .modal-backdrop {
        z-index: 0 !important;
       
        top: 0 !important;
        left: 0 !important;
        width: 100vh !important;
        height: 100vh !important;
        background-color: rgba(0, 0, 0, 0.5) !important;
      }
.interview-dashboard {
     background: #fafafa;
  border-top: 4px solid #8bb7ff; 
  min-height: 100vh;

  padding: 3rem 2rem;
}

.dashboard-header {
background: linear-gradient(135deg, #f8fafc 0%, #55aaff 100%);
  border-left: 10px solid #3b82f6;
  border-radius: 1rem;
  padding: 2rem;
  margin-bottom: 2rem;
  color: #1f2937;
  box-shadow: 0 10px 10px 10px rgba(0, 0, 0, 0.05);
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.stat-card {
  background: white;
  border-radius: 1rem;
  padding: 1.5rem;
  text-align: center;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
  transition: transform 0.3s ease;
}

.stat-card:hover {
  transform: translateY(-5px);
}

.stat-number {
  font-size: 2rem;
  font-weight: 700;
  color: #3b82f6;
  margin-bottom: 0.5rem;
}

.stat-label {
  color: #6b7280;
  font-weight: 500;
}

.interview-section {
  background: white;
  border-radius: 1rem;
  padding: 1.5rem;
  margin-bottom: 2rem;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
}

.section-header {
  display: flex;
  justify-content: between;
  align-items: center;
  margin-bottom: 1.5rem;
  padding-bottom: 0.75rem;
  border-bottom: 2px solid #e5e7eb;
}

.interview-card {
  border: 1px solid #e5e7eb;
  border-radius: 0.75rem;
  padding: 1.5rem;
  margin-bottom: 1rem;
  transition: all 0.3s ease;
  position: relative;
}

.interview-card:hover {
  border-color: #3b82f6;
  box-shadow: 0 5px 15px rgba(59, 130, 246, 0.1);
}

.interview-card.upcoming {
  border-left: 4px solid #10b981;
  background: linear-gradient(135deg, #ecfdf5, #f0fdf4);
}

.interview-card.completed {
  border-left: 4px solid #6b7280;
}

.interview-card.pending {
  border-left: 4px solid #f59e0b;
  background: linear-gradient(135deg, #fffbeb, #fefce8);
}

.interview-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 1rem;
}

.job-info h4 {
  color: #1f2937;
  margin-bottom: 0.25rem;
}

.company-name {
  color: #6b7280;
  font-size: 0.875rem;
}

.interview-status {
  padding: 0.375rem 0.75rem;
  border-radius: 0.5rem;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
}

.status-upcoming {
  background: #dcfce7;
  color: #166534;
}

.status-completed {
  background: #f3f4f6;
  color: #374151;
}

.status-pending {
  background: #fef3c7;
  color: #92400e;
}

.interview-details {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
  margin-bottom: 1rem;
  
}

.detail-item {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  color: #4b5563;
  font-size: 0.875rem;
}

.detail-icon {
  color: #3b82f6;
  font-size: 1rem;
}

.interview-actions {
  display: flex;
  gap: 0.5rem;
  margin-top: 1rem;
  z-index: 0;
}

.btn-interview {
  padding: 0.5rem 1rem;
  border: none;
  border-radius: 0.375rem;
  font-size: 0.875rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s ease;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: 0.25rem;
}

.btn-primary {
  background: #3b82f6;
  color: white;
}

.btn-primary:hover {
  background: #2563eb;
  color: white;
  text-decoration: none;
}

.btn-outline {
  background: transparent;
  color: #3b82f6;
  border: 1px solid #3b82f6;
}

.btn-outline:hover {
  background: #3b82f6;
  color: white;
}

.empty-state {
  text-align: center;
  padding: 3rem 1rem;
  color: #6b7280;
}

.empty-icon {
  font-size: 3rem;
  margin-bottom: 1rem;
  opacity: 0.5;
}

.match-score {
  display: inline-flex;
  align-items: center;
  gap: 0.25rem;
  background: #dbeafe;
  color: #1e40af;
  padding: 0.25rem 0.5rem;
  border-radius: 0.375rem;
  font-size: 0.75rem;
  font-weight: 600;
}

.ai-badge {
  background: linear-gradient(135deg, #8b5cf6, #7c3aed);
  color: white;
  padding: 0.125rem 0.375rem;
  border-radius: 0.25rem;
  font-size: 0.625rem;
  font-weight: 600;
  margin-left: 0.5rem;
}

.interview-feedback {
  background: #f0f9ff;
  border: 1px solid #e0f2fe;
  border-radius: 0.5rem;
  padding: 1rem;
  margin-top: 1rem;
}

.feedback-title {
  font-weight: 600;
  color: #0369a1;
  margin-bottom: 0.5rem;
}

.feedback-content {
  color: #0c4a6e;
  font-size: 0.875rem;
}

.countdown-timer {
  background: linear-gradient(135deg, #10b981, #047857);
  color: white;
  padding: 0.5rem 1rem;
  border-radius: 0.5rem;
  font-weight: 600;
  text-align: center;
}

@media (max-width: 768px) {
  .interview-dashboard {
    padding: 1rem;
  }
  
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .interview-details {
    grid-template-columns: 1fr;
  
  }
  
  .interview-header {
    flex-direction: column;
    gap: 1rem;
  }
}
</style>

<div class="interview-dashboard">
  <!-- Dashboard Header -->
  <div class="dashboard-header">
    <div class="d-flex align-items-center justify-content-between flex-wrap gap-4">
      <div>
        <h1 class="h2 mb-2">My Interviews</h1>
        <p class="mb-0 opacity-90">Manage your interview schedule and track progress</p>
      </div>
      <div class="text-end">
        <div class="small opacity-75">{{ current_date.strftime('%B %d, %Y') if current_date else '' }}</div>
        <div class="h4 mb-0">{{ current_date.strftime('%I:%M %p') if current_date else '' }}</div>
      </div>
    </div>
  </div>

  <!-- Statistics -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-number">{{ stats.total_interviews or 0 }}</div>
      <div class="stat-label">Total Interviews</div>
    </div>
    <div class="stat-card">
      <div class="stat-number">{{ stats.upcoming_count or 0 }}</div>
      <div class="stat-label">Upcoming</div>
    </div>
    <div class="stat-card">
      <div class="stat-number">{{ stats.completed_count or 0 }}</div>
      <div class="stat-label">Completed</div>
    </div>
    <div class="stat-card">
      <div class="stat-number">{{ stats.success_rate or 0 }}%</div>
      <div class="stat-label">Success Rate</div>
    </div>
  </div>

  <!-- Upcoming Interviews -->
  <div class="interview-section">
    <div class="section-header">
      <h3 class="h5 mb-0">üóìÔ∏è Upcoming Interviews</h3>
    </div>
    
    {% if upcoming_interviews %}
      {% for interview in upcoming_interviews %}
      <div class="interview-card upcoming">
        <div class="interview-header">
          <div class="job-info">
            <h4 class="h6 mb-1">{{ interview.job_title }}</h4>
            <div class="company-name">{{ interview.company_name }}</div>
          </div>
          <div class="d-flex align-items-center gap-2">
            <span class="match-score">
              üéØ {{ interview.match_score }}%
            </span>
            {% if interview.ai_enhanced %}
            <span class="ai-badge">AI</span>
            {% endif %}
            <span class="interview-status status-upcoming">Scheduled</span>
          </div>
        </div>
        
        <div class="interview-details">
          {% if interview.interview_date %}
          <div class="detail-item">
            <span class="detail-icon">üìÖ</span>
            <span>{{ interview.interview_date.strftime('%B %d, %Y') }}</span>
          </div>
          {% endif %}
          
          {% if interview.interview_time %}
          <div class="detail-item">
            <span class="detail-icon">üïê</span>
            <span>{{ interview.interview_time }}</span>
          </div>
          {% endif %}
          
          {% if interview.interview_type %}
          <div class="detail-item">
            <span class="detail-icon">üíº</span>
            <span>{{ interview.interview_type }}</span>
          </div>
          {% endif %}
          
          {% if interview.interview_location or interview.meeting_link %}
          <div class="detail-item">
            <span class="detail-icon">üìç</span>
            <span>
              {% if interview.meeting_link %}
              <a href="{{ interview.meeting_link }}" target="_blank" class="text-primary text-decoration-none">
                Virtual Meeting
              </a>
              {% else %}
              {{ interview.interview_location }}
              {% endif %}
            </span>
          </div>
          {% endif %}
        </div>
        
        {% if interview.interviewer_name %}
        <div class="small text-muted mb-2">
          <strong>Interviewer:</strong> {{ interview.interviewer_name }}
          {% if interview.interviewer_email %}
          ({{ interview.interviewer_email }})
          {% endif %}
        </div>
        {% endif %}
        
        {% if interview.notes %}
        <div class="small text-muted mb-2">
          <strong>Notes:</strong> {{ interview.notes }}
        </div>
        {% endif %}
        
        <div class="interview-actions">
          {% if interview.meeting_link %}
          <a href="{{ interview.meeting_link }}" target="_blank" class="btn-interview btn-primary">
            Join Meeting
          </a>
          {% endif %}
          <button onclick="viewInterviewDetails('{{ interview.application_id }}')" class="btn-interview btn-outline">
            View Details
          </button>
        </div>
        
        {% if interview.interview_date and (interview.interview_date - current_date).days <= 1 %}
        <div class="countdown-timer mt-2">
          Interview in {{ ((interview.interview_date - current_date).total_seconds() / 3600)|round|int }} hours
        </div>
        {% endif %}
      </div>
      {% endfor %}
    {% else %}
    <div class="empty-state">
      <div class="empty-icon">üìÖ</div>
      <p class="mb-2">No upcoming interviews</p>
      <a href="/HR1/show_job" class="text-primary text-decoration-none">Browse jobs to apply</a>
    </div>
    {% endif %}
  </div>

  <!-- Pending Interviews -->
  {% if pending_interviews %}
  <div class="interview-section">
    <div class="section-header">
      <h3 class="h5 mb-0">‚è≥ Pending Interviews ({{ pending_interviews|length }})</h3>
    </div>
    
    {% for interview in pending_interviews %}
    <div class="interview-card pending">
      <div class="interview-header">
        <div class="job-info">
          <h4 class="h6 mb-1">{{ interview.job_title }}</h4>
          <div class="company-name">{{ interview.company_name }}</div>
        </div>
        <div class="d-flex align-items-center gap-2">
          <span class="match-score">
            üéØ {{ interview.match_score }}%
          </span>
          {% if interview.ai_enhanced %}
          <span class="ai-badge">AI</span>
          {% endif %}
          <span class="interview-status status-pending">
            {{ interview.status|title|replace('_', ' ') }}
          </span>
        </div>
      </div>
      
      <div class="detail-item mb-2">
        <span class="detail-icon">üìÖ</span>
        <span>Applied {{ interview.applied_date.strftime('%B %d, %Y') if interview.applied_date else 'Recently' }}</span>
      </div>
      
      <div class="small text-muted mb-2">
        <strong>Status:</strong> {{ interview.status }} 
        <span class="badge bg-secondary ms-2">{{ interview.application_id[:8] }}...</span>
      </div>
      
      <p class="small text-muted mb-3">
        {% if interview.status == 'interview_pending' %}
          Your application has been shortlisted for an interview. HR will schedule the interview soon.
        {% elif interview.status == 'shortlisted' %}
          Congratulations! You've been shortlisted. Interview scheduling is in progress.
        {% else %}
          Waiting for interview scheduling. You'll receive an email notification once the interview is scheduled.
        {% endif %}
      </p>
      
      <div class="interview-actions">
        <button onclick="viewInterviewDetails('{{ interview.application_id }}')" class="btn-interview btn-outline">
          View Application Details
        </button>
      </div>
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- Past Interviews -->
  <div class="interview-section">
    <div class="section-header">
      <h3 class="h5 mb-0">üìã Past Interviews</h3>
    </div>
    
    {% if past_interviews %}
      {% for interview in past_interviews %}
      <div class="interview-card completed">
        <div class="interview-header">
          <div class="job-info">
            <h4 class="h6 mb-1">{{ interview.job_title }}</h4>
            <div class="company-name">{{ interview.company_name }}</div>
          </div>
          <div class="d-flex align-items-center gap-2">
            <span class="match-score">
              üéØ {{ interview.match_score }}%
            </span>
            {% if interview.ai_enhanced %}
            <span class="ai-badge">AI</span>
            {% endif %}
            <span class="interview-status status-completed">Completed</span>
          </div>
        </div>
        
        <div class="interview-details">
          {% if interview.interview_date %}
          <div class="detail-item">
            <span class="detail-icon">üìÖ</span>
            <span>{{ interview.interview_date.strftime('%B %d, %Y') }}</span>
          </div>
          {% endif %}
          
          {% if interview.interview_type %}
          <div class="detail-item">
            <span class="detail-icon">üíº</span>
            <span>{{ interview.interview_type }}</span>
          </div>
          {% endif %}
          
          {% if interview.interviewer_name %}
          <div class="detail-item">
            <span class="detail-icon">üë§</span>
            <span>{{ interview.interviewer_name }}</span>
          </div>
          {% endif %}
        </div>
        
        {% if interview.feedback_received %}
        <div class="interview-feedback">
          <div class="feedback-title">Interview Feedback Received</div>
          <div class="feedback-content">
            Check your email or contact HR for detailed feedback from this interview.
          </div>
        </div>
        {% endif %}
        
        <div class="interview-actions">
          <button onclick="viewInterviewDetails('{{ interview.application_id }}')" class="btn-interview btn-outline">
            View Details
          </button>
        </div>
      </div>
      {% endfor %}
    {% else %}
    <div class="empty-state">
      <div class="empty-icon">üìã</div>
      <p class="mb-0">No completed interviews yet</p>
    </div>
    {% endif %}
  </div>
</div>

<!-- Interview Details Modal -->
<div class="modal fade" id="interviewDetailsModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Interview Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" id="interviewDetailsContent">
        <div class="text-center py-4">
          <div class="spinner-border text-primary" role="status"></div>
          <div class="mt-2">Loading interview details...</div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<script>
// Interview management functions
function viewInterviewDetails(applicationId) {
  const modal = new bootstrap.Modal(document.getElementById('interviewDetailsModal'));
  const content = document.getElementById('interviewDetailsContent');
  
  // Show loading state
  content.innerHTML = `
    <div class="text-center py-4">
      <div class="spinner-border text-primary" role="status"></div>
      <div class="mt-2">Loading interview details...</div>
    </div>
  `;
  
  modal.show();
  
  // Fetch interview details
  fetch(`/get_interview_details/${applicationId}`)
    .then(response => response.json())
    .then(data => {
      if (data.error) {
        content.innerHTML = `
          <div class="alert alert-danger">
            <strong>Error:</strong> ${data.error}
          </div>
        `;
        return;
      }
      
      // Format interview details
      let detailsHtml = `
        <div class="row">
          <div class="col-md-6">
            <h6 class="text-primary">Job Information</h6>
            <p><strong>Position:</strong> ${data.job_title}</p>
            <p><strong>Company:</strong> ${data.company_name}</p>
          </div>
          <div class="col-md-6">
            <h6 class="text-primary">Interview Information</h6>
      `;
      
      if (data.interview_date) {
        const interviewDate = new Date(data.interview_date);
        detailsHtml += `<p><strong>Date:</strong> ${interviewDate.toLocaleDateString()}</p>`;
      }
      
      if (data.interview_time) {
        detailsHtml += `<p><strong>Time:</strong> ${data.interview_time}</p>`;
      }
      
      if (data.interview_type) {
        detailsHtml += `<p><strong>Type:</strong> ${data.interview_type}</p>`;
      }
      
      if (data.interview_location) {
        detailsHtml += `<p><strong>Location:</strong> ${data.interview_location}</p>`;
      }
      
      if (data.meeting_link) {
        detailsHtml += `<p><strong>Meeting Link:</strong> <a href="${data.meeting_link}" target="_blank" class="text-primary">Join Meeting</a></p>`;
      }
      
      detailsHtml += `</div></div>`;
      
      if (data.interviewer_name || data.interviewer_email) {
        detailsHtml += `
          <div class="mt-3">
            <h6 class="text-primary">Interviewer Information</h6>
        `;
        
        if (data.interviewer_name) {
          detailsHtml += `<p><strong>Name:</strong> ${data.interviewer_name}</p>`;
        }
        
        if (data.interviewer_email) {
          detailsHtml += `<p><strong>Email:</strong> <a href="mailto:${data.interviewer_email}">${data.interviewer_email}</a></p>`;
        }
        
        detailsHtml += `</div>`;
      }
      
      if (data.notes) {
        detailsHtml += `
          <div class="mt-3">
            <h6 class="text-primary">Additional Notes</h6>
            <p>${data.notes}</p>
          </div>
        `;
      }
      
      if (data.feedback) {
        detailsHtml += `
          <div class="mt-3">
            <h6 class="text-primary">Interview Feedback</h6>
            <div class="alert alert-info">
              Feedback has been received. Contact HR for detailed information.
            </div>
          </div>
        `;
      }
      
      content.innerHTML = detailsHtml;
    })
    .catch(error => {
      console.error('Error fetching interview details:', error);
      content.innerHTML = `
        <div class="alert alert-danger">
          <strong>Error:</strong> Failed to load interview details. Please try again.
        </div>
      `;
    });
}

// Real-time updates for interview countdown
function updateCountdownTimers() {
  const timers = document.querySelectorAll('.countdown-timer');
  timers.forEach(timer => {
    // Update countdown logic here if needed
  });
}

// Update every minute
setInterval(updateCountdownTimers, 60000);

// Initialize tooltips and other interactive elements
document.addEventListener('DOMContentLoaded', function() {
  // Add any initialization code here
  
  // Smooth scroll for anchor links
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute('href'));
      if (target) {
        target.scrollIntoView({
          behavior: 'smooth'
        });
      }
    });
  });
});
</script>

{% endblock %}